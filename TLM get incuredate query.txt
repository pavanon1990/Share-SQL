  CASE
    WHEN CTEB.CTEB_PAYMENT_IND = 1 THEN
      CASE
        WHEN TTYP.TTYP_SHORT_DESCRIPTION = 'Paymt Into Susp' THEN
          CASE
            WHEN PAYMENT_CODE.CODE_SHORT_DESCRIPTION in ('Direct credit','Credit card','Direct Debit') THEN PEP_PKG.CONVERT_DATE(MTRB.MTRB_DATE_AUTHORISED)-- PEP_PKG.CONVERT_DATE(MTRB.MTRB_DATE_AUTHORISED)
          END
      END
    WHEN CTEB.CTEB_PAYMENT_IND = -1 THEN
      CASE
        WHEN PAYMENT_CODE.CODE_SHORT_DESCRIPTION in ('Bank draft','Cheque','Company cheque','Cheque payment') THEN PEP_PKG.CONVERT_DATE(CHQE.CHQE_DATE_PRINTED)
        WHEN PAYMENT_CODE.CODE_SHORT_DESCRIPTION in ('Direct Debit') THEN PEP_PKG.CONVERT_DATE(MTRB.MTRB_DATE_AUTHORISED) --PEP_PKG.CONVERT_DATE(MTTR.MTTR_DUE_DATE)
        WHEN PAYMENT_CODE.CODE_SHORT_DESCRIPTION in ('Credit card','Direct credit') THEN PEP_PKG.CONVERT_DATE(MTTR.MTTR_DUE_DATE) --PEP_PKG.CONVERT_DATE(MTTR.MTTR_DUE_DATE)
      END
  END CTEB_DATE_PAID
  
  FROM TSCM_ACCOUNT_LINK ACLK
  INNER JOIN TSCM_ACCOUNT_TRANSACTION ACTR ON ACTR.ACTR_ACCOUNT_ID = ACLK.ACLK_ID
  INNER JOIN TSCM_TRANSACTION_EVENT TREV ON TREV.TREV_ID = ACTR.ACTR_TRANSACTION_EVENT_ID
  INNER JOIN TSCM_TRANSACTION_TYPE TTYP ON TTYP.TTYP_ID = TREV.TREV_TRANSACTION_TYPE_ID
  INNER JOIN TSCM_CLIENT_TRANS_EVENT_BRIDGE CTEB ON CTEB.CTEB_TRANSACTION_EVENT_ID = TREV.TREV_ID
  INNER JOIN TSCM_CLIENT CLNT ON CLNT.CLNT_ID = CTEB.CTEB_CLIENT_ID
  --LEFT JOIN tscm_application APPL ON NVL(APPL.APPL_MTS_ROW_ID,APPL.APPL_CHEQUE_ID)  = NVL(CTEB.CTEB_MTS_ROW_ID,CTEB.CTEB_CHEQUE_ID)
  --LEFT JOIN tscm_application APPL ON APPL.APPL_TRANSACTION_EVENT_ID = TREV.TREV_ID
  --LEFT JOIN tscm_receipt RCPT ON RCPT.RCPT_ID = APPL.appl_receipt_id
  LEFT JOIN TSCM_MT_TRANSACTION MTTR ON MTTR_ID = CTEB.CTEB_MTS_ROW_ID
  LEFT JOIN TSCM_MT_BATCH MTRB ON MTRB.MTRB_ID = MTTR.MTTR_BATCH_ID
  LEFT JOIN TSCM_MT_BATCH_TYPE MTBT ON MTBT.MTBT_ID = MTRB.MTRB_BATCH_TYPE_ID
  LEFT JOIN TSCM_CHEQUE CHQE ON CHQE.CHQE_ID = CTEB.CTEB_CHEQUE_ID
  LEFT JOIN TSCM_CHEQUE_BATCH CQBT ON CQBT.CQBT_ID = CHQE.CHQE_CHEQUE_BATCH_ID
  LEFT JOIN TSCM_CODE PAYMENT_CODE ON PAYMENT_CODE.CODE_ID = CTEB.CTEB_PAYMT_METHOD_CODE_ID
  LEFT JOIN TSCM_CODE CHQE_CODE ON CHQE_CODE.CODE_ID = CHQE.CHQE_STATUS_CODE_ID
  LEFT JOIN TSCM_CODE CHQESTS_CODE ON CHQESTS_CODE.CODE_ID = CHQE.CHQE_EXT_STATUS_CODE_ID
  LEFT JOIN TSCM_CODE MTTR_CODE ON MTTR_CODE.CODE_ID = MTTR.MTTR_TRANS_STATUS_CODE_ID
  LEFT JOIN TSCM_CODE PRINT_CODE ON PRINT_CODE.CODE_ID = CTEB.CTEB_CHEQUE_PRINTER_CODE_ID
  --LEFT JOIN TSCM_CODE APPL_CODE ON APPL_CODE.CODE_ID = APPL.APPL_STATUS_CODE_ID
  --LEFT JOIN TSCM_PHRASE_TRANSLATION TSPT ON TSPT.TSPT_PHRASE = APPL_CODE.CODE_SHORT_DESCRIPTION
  WHERE ACLK.ACLK_ID = P_ACLK AND TREV.TREV_ID = P_TREV_ID
    AND CTEB.CTEB_PAYMENT_IND = -1
    AND CTEB.CTEB_PAYMT_METHOD_CODE_ID IS NOT NULL
