-- LOG FOR MIG_NC_LOG
--insert into MIG_NC_LOG  -- MIG_NC_TPYFDTD
select SYS_GUID(),'MIG_NC_TPYFDTD' as FIL_ENAME,t.Core_System,t.Module_Type,gps.gp_polno,gps.gp_custrefno
,CASE WHEN Module_Type = 'TCLM' THEN 'Data not found PLAN CODE in DATA_CONSO.CLAIM_TRANSACTION' ELSE 'Data not found PLAN CODE in POLMSTPF' END 
,'GPS'
  from mig_nc_tpyfdtd t
inner join gps_payment gps on TRIM('S'||t.wkpayn) = gps.gp_custrefno
where t.wkplnc is null


INSERT INTO MIG_NC_LOG --MIG_NC_TPYFILNC
select SYS_GUID(),'MIG_NC_TPYFILNC' as FIL_ENAME ,gps.GP_CORE_SYSTEM,gps.ModuleCode,gps.GP_POLNO,gps.GP_CUSTREFNO
       ,'Can not mapping data from table data_conso.cclient_pol' as MESSAGE
       ,'GPS'
from (
select '10000'||substr(trim(inf.pywref),2,length(inf.pywref)) as polno,inf.pywref,lnc.wkrefn from mig_nc_interface inf
      left join 
           (
              select t.wkrefn,t.wkorgn from MIG_NC_TPYFILNC t
              group by t.wkrefn,t.wkorgn
           )lnc on trim(inf.pywref) = trim(lnc.wkrefn)
where lnc.wkrefn is null
) mtb 
inner join data_gps gps on mtb.polno = gps.GP_POLNO

------
insert into MIG_NC_LOG
select 
SYS_GUID(),UPPER('mig_nc_interface') as FILE_NAME,t.core_system,PYWMOD,gps.gp_polno,gps.gp_custrefno,
'Data not found VALUES02 CASE SYSTEM_NAME=''GPS'' and TRANS_CODE=''C01''and TRANS_S01='''||gps.gp_paymth||''' and TRANS_S02='''||gps.gp_sub_paymth||''' and TRANS_S03 = '''||gps.gp_lastupd_sts||''''
from mig_nc_interface t
inner join gps_payment gps on TRIM(t.pywref) = replace(gps.gp_polno,'XXXXX','3') and TRIM(t.PYWPYN) = 'N'||gps.gp_custrefno 
where PYWTRS is null
